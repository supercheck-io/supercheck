apiVersion: v1
kind: ConfigMap
metadata:
  name: supercheck-config
  namespace: supercheck
  labels:
    app.kubernetes.io/name: supercheck
    app.kubernetes.io/component: config
data:
  NODE_ENV: "production"
  LOG_LEVEL: "info"
  NEXT_PUBLIC_APP_URL: "https://app.supercheck.example.com"
  APP_URL: "https://app.supercheck.example.com"
  BETTER_AUTH_URL: "https://app.supercheck.example.com"
  STATUS_PAGE_DOMAIN: "status.supercheck.example.com"
  # Demo mode - shows demo badge in UI (runtime configurable)
  DEMO_MODE: "false"

  DB_HOST: "postgres.example.com"
  DB_PORT: "5432"
  DB_NAME: "supercheck"
  DB_USER: "supercheck"

  REDIS_HOST: "redis.example.com"
  REDIS_PORT: "6379"

  AWS_REGION: "auto"
  S3_ENDPOINT: "https://r2.example.com"
  S3_FORCE_PATH_STYLE: "true"
  S3_OPERATION_TIMEOUT: "10000"
  S3_MAX_RETRIES: "3"
  S3_JOB_BUCKET_NAME: "playwright-job-artifacts"
  S3_TEST_BUCKET_NAME: "playwright-test-artifacts"
  S3_MONITOR_BUCKET_NAME: "playwright-monitor-artifacts"
  S3_STATUS_BUCKET_NAME: "supercheck-status-artifacts"
  S3_PERFORMANCE_BUCKET_NAME: "supercheck-performance-artifacts"

  RUNNING_CAPACITY: "6"
  QUEUED_CAPACITY: "50"
  MAX_CONCURRENT_EXECUTIONS: "1"
  CONTAINER_CPU_LIMIT: "1.5"
  CONTAINER_MEMORY_LIMIT_MB: "2048"
  TEST_EXECUTION_TIMEOUT_MS: "120000"
  JOB_EXECUTION_TIMEOUT_MS: "900000"
  K6_TEST_EXECUTION_TIMEOUT_MS: "3600000"
  K6_JOB_EXECUTION_TIMEOUT_MS: "3600000"

  PLAYWRIGHT_HEADLESS: "true"
  PLAYWRIGHT_RETRIES: "1"
  PLAYWRIGHT_TRACE: "retain-on-failure"
  PLAYWRIGHT_SCREENSHOT: "only-on-failure"
  PLAYWRIGHT_VIDEO: "retain-on-failure"

  # Monitor Results Cleanup (retention per plan from database)
  MONITOR_CLEANUP_ENABLED: "true"
  MONITOR_CLEANUP_CRON: "0 2 * * *"
  MONITOR_CLEANUP_BATCH_SIZE: "1000"
  MONITOR_PRESERVE_STATUS_CHANGES: "true"
  MONITOR_CLEANUP_SAFETY_LIMIT: "1000000"

  # Monitor Aggregates Cleanup (retention per plan from database)
  MONITOR_AGGREGATES_CLEANUP_ENABLED: "true"
  MONITOR_AGGREGATES_CLEANUP_CRON: "30 2 * * *"
  MONITOR_AGGREGATES_CLEANUP_BATCH_SIZE: "1000"
  MONITOR_AGGREGATES_CLEANUP_SAFETY_LIMIT: "500000"

  # Job Runs Cleanup (retention per plan from database)
  JOB_RUNS_CLEANUP_ENABLED: "true"
  JOB_RUNS_CLEANUP_CRON: "0 3 * * *"
  JOB_RUNS_CLEANUP_BATCH_SIZE: "100"
  JOB_RUNS_CLEANUP_SAFETY_LIMIT: "10000"

  PLAYGROUND_CLEANUP_ENABLED: "false"
  PLAYGROUND_CLEANUP_CRON: "0 */12 * * *"
  PLAYGROUND_CLEANUP_MAX_AGE_HOURS: "24"

  # Webhook Idempotency Cleanup (TTL-based deduplication records)
  WEBHOOK_CLEANUP_ENABLED: "true"
  WEBHOOK_CLEANUP_CRON: "0 4 * * *"
  WEBHOOK_CLEANUP_BATCH_SIZE: "1000"
  WEBHOOK_CLEANUP_SAFETY_LIMIT: "100000"

  # Notification channel limits (runtime configurable)
  MAX_JOB_NOTIFICATION_CHANNELS: "10"
  MAX_MONITOR_NOTIFICATION_CHANNELS: "10"

  WORKER_LOCATION: "local"

  SMTP_HOST: "smtp.resend.com"
  SMTP_PORT: "587"
  SMTP_USER: "resend"
  SMTP_SECURE: "false"
  SMTP_FROM_EMAIL: "notification@example.com"

  AI_PROVIDER: "openai"
  AI_MODEL: "gpt-4o-mini"
  AI_TIMEOUT_MS: "90000"
  AI_MAX_RETRIES: "2"
  AI_TEMPERATURE: "0.1"

  # Self-Hosted Mode (set to 'true' for unlimited features without Polar billing)
  SELF_HOSTED: "true"

  # Polar Billing Configuration (only for cloud deployments)
  # Set SELF_HOSTED=false to enable Polar billing
  POLAR_SERVER: "production"
  POLAR_PLUS_PRODUCT_ID: ""
  POLAR_PRO_PRODUCT_ID: ""

  # OAuth Configuration (optional - enable social login)
  # Social auth buttons are automatically shown when GITHUB_CLIENT_ID/GOOGLE_CLIENT_ID are set in secrets
  # Configure OAuth secrets (GITHUB_CLIENT_ID, GITHUB_CLIENT_SECRET, GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET)
  # in a separate Kubernetes Secret resource
