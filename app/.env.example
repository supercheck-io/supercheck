# Environment variables for App
# Copy this file to .env and update the values

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

DATABASE_URL=postgresql://postgres:postgres@localhost:5432/supercheck

# Connection Pool Settings (postgres-js)
# See: https://github.com/porsager/postgres#connection-pool
DB_POOL_MAX=10                 # Maximum number of connections (default: 10)
DB_IDLE_TIMEOUT=30             # Seconds before idle connections are closed (default: 30)
DB_CONNECT_TIMEOUT=10          # Seconds to wait for connection (default: 10)
DB_MAX_LIFETIME=1800           # Seconds before connections are recycled (default: 1800 = 30 min)

# =============================================================================
# AWS S3 / MINIO CONFIGURATION
# =============================================================================

AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=minioadmin
AWS_SECRET_ACCESS_KEY=minioadmin
S3_ENDPOINT=http://localhost:9000
S3_JOB_BUCKET_NAME=playwright-job-artifacts
S3_TEST_BUCKET_NAME=playwright-test-artifacts
S3_MONITOR_BUCKET_NAME=playwright-monitor-artifacts
S3_K6_TEST_BUCKET_NAME=k6-test-artifacts
S3_K6_JOB_BUCKET_NAME=k6-job-artifacts
S3_STATUS_BUCKET_NAME=status-page-artifacts
S3_FORCE_PATH_STYLE=true
S3_OPERATION_TIMEOUT=10000
S3_MAX_RETRIES=3

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

# Build-time env var (embedded in Next.js bundle for browser auth client)
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Runtime env vars for middleware (middleware can't access NEXT_PUBLIC_ vars at runtime)
APP_URL=http://localhost:3000
STATUS_PAGE_DOMAIN=supercheck.io

# Additional trusted origins for CORS/CSRF (comma-separated, optional)
# Used in production to allow cross-origin requests from additional domains
# Example: https://admin.example.com,https://api.example.com
# TRUSTED_ORIGINS=

TEST_EXECUTION_TIMEOUT_MS=300000 # 5 minutes
JOB_EXECUTION_TIMEOUT_MS=3600000 # 1 hour
K6_TEST_EXECUTION_TIMEOUT_MS=3600000 # 1 hour
K6_JOB_EXECUTION_TIMEOUT_MS=3600000 # 1 hour

# Parallel Execution Capacity (SELF-HOSTED MODE ONLY)
# These env vars are ONLY used when SELF_HOSTED=true. In cloud mode, plan limits apply:
#   - Plus plan: 5 running, 50 queued
#   - Pro plan: 10 running, 100 queued
# For self-hosted, set these to match your worker replicas (each worker handles 1 concurrent job)
RUNNING_CAPACITY=2   # Max concurrent executions (should match WORKER_REPLICAS)
QUEUED_CAPACITY=10   # Max jobs waiting in queue

# Demo Mode (runtime configurable via /api/config/app)
DEMO_MODE=false

# Notification Channel Limits (runtime configurable via /api/config/app)
MAX_JOB_NOTIFICATION_CHANNELS=10
MAX_MONITOR_NOTIFICATION_CHANNELS=10

# Document Upload Limits (Requirements System)
MAX_DOCUMENT_SIZE_MB=10
MAX_DOCUMENTS_PER_PROJECT=100

# Environment and Logging
# NODE_ENV controls logging verbosity:
# - development: Enables DEBUG logs and pretty-printed console output
# - production: Structured JSON logging for production systems
# - test: Silent mode (no logs)
NODE_ENV=development

# LOG_LEVEL overrides the default log level (trace, debug, info, warn, error, fatal)
# If not set, defaults based on NODE_ENV: debug (dev), info (prod), silent (test)
# LOG_LEVEL=debug

# LOG_DB_QUERIES enables database query logging in development mode
# Set to 'true' to see SQL queries with parameters (development only)
# Warning: May produce verbose output and impact performance
# LOG_DB_QUERIES=false

# =============================================================================
# DATA LIFECYCLE MANAGEMENT (CLEANUP) CONFIGURATION
# =============================================================================
# Note: Retention periods are configured per plan in the database (plan_limits table)
# The cleanup jobs use plan settings, not environment variables for retention days.

# Monitor Results Cleanup (retention per plan from database)
MONITOR_CLEANUP_ENABLED=true
MONITOR_CLEANUP_CRON="0 2 * * *"                  # 2 AM daily
MONITOR_CLEANUP_BATCH_SIZE=1000                    # Batch size for deletions
MONITOR_PRESERVE_STATUS_CHANGES=true               # Keep status change events
MONITOR_CLEANUP_SAFETY_LIMIT=1000000               # Max records per cleanup run

# Monitor Aggregates Cleanup (retention per plan from database)
MONITOR_AGGREGATES_CLEANUP_ENABLED=true
MONITOR_AGGREGATES_CLEANUP_CRON="30 2 * * *"      # 2:30 AM daily
MONITOR_AGGREGATES_CLEANUP_BATCH_SIZE=1000         # Batch size for deletions
MONITOR_AGGREGATES_CLEANUP_SAFETY_LIMIT=500000     # Max records per cleanup run

# Job Runs Cleanup (retention per plan from database)
JOB_RUNS_CLEANUP_ENABLED=true                      # Enabled by default for storage management
JOB_RUNS_CLEANUP_CRON="0 3 * * *"                 # 3 AM daily
JOB_RUNS_CLEANUP_BATCH_SIZE=100                    # Smaller batches for complex operations
JOB_RUNS_CLEANUP_SAFETY_LIMIT=10000                # Max records per cleanup run

# Playground Artifacts Cleanup
PLAYGROUND_CLEANUP_ENABLED=true
PLAYGROUND_CLEANUP_CRON="0 5 * * *"               # 5 AM daily
PLAYGROUND_CLEANUP_MAX_AGE_HOURS=24               # Delete after 24 hours

# Webhook Idempotency Cleanup (TTL-based deduplication records)
WEBHOOK_CLEANUP_ENABLED=true
WEBHOOK_CLEANUP_CRON="0 4 * * *"                  # 4 AM daily
WEBHOOK_CLEANUP_BATCH_SIZE=1000                    # Batch size for deletions
WEBHOOK_CLEANUP_SAFETY_LIMIT=100000                # Max records per cleanup run

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=supersecure-redis-password-change-this
REDIS_URL=redis://:supersecure-redis-password-change-this@localhost:6379
# Enable TLS for cloud Redis (Upstash, Redis Cloud, etc.) - set to 'true' in production
REDIS_TLS_ENABLED=false
# Reject unauthorized TLS certificates (set to 'false' only for self-signed certs, not recommended)
REDIS_TLS_REJECT_UNAUTHORIZED=true

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# Better Auth Secret - REQUIRED for production (generate with: openssl rand -hex 32)
BETTER_AUTH_SECRET=your-super-secret-key-change-this-in-production
BETTER_AUTH_URL=http://localhost:3000

# Social Authentication Providers (OPTIONAL)
# Social auth buttons are automatically shown when credentials are configured
# No separate "enabled" flags needed - presence of credentials enables the provider

# GitHub OAuth - Get credentials from https://github.com/settings/developers
# Callback URL: http://localhost:3000/api/auth/callback/github (or your domain in production)
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret

# Google OAuth - Get credentials from https://console.cloud.google.com/apis/credentials
# Callback URL: http://localhost:3000/api/auth/callback/google (or your domain in production)
GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret

# =============================================================================
# CAPTCHA CONFIGURATION (Cloudflare Turnstile)
# =============================================================================

# CAPTCHA protection for authentication endpoints
# Get keys from https://dash.cloudflare.com/?to=/:account/turnstile
#
# CAPTCHA is automatically enabled when both keys are set
# Protected endpoints: /sign-in/email, /sign-up/email, /forget-password
#
# For local development, leave these empty to disable CAPTCHA
# For production, create a Turnstile site and add both keys

# Site Key (public) - exposed to client via /api/config/captcha endpoint
TURNSTILE_SITE_KEY=

# Secret Key (private) - used server-side for verification
TURNSTILE_SECRET_KEY=

# Encryption Keys - REQUIRED for production
# Generate with: openssl rand -hex 32
VARIABLES_ENCRYPTION_KEY=your-64-character-encryption-key-for-variable-secrets-change-this-in-prod
CREDENTIAL_ENCRYPTION_KEY=your-credential-encryption-key-change-this-in-production

# =============================================================================
# ADMIN CONFIGURATION
# =============================================================================

MAX_PROJECTS_PER_ORG=10
DEFAULT_PROJECT_NAME="Default Project"

# =============================================================================
# EMAIL CONFIGURATION FOR NOTIFICATIONS
# =============================================================================

# SMTP Configuration - Can use any SMTP provider including Resend's SMTP
# Examples:
# - Gmail: smtp.gmail.com (use App Password with 2FA enabled)
# - Resend SMTP: smtp.resend.com (use API key as password)
# - SendGrid: smtp.sendgrid.net
# - Amazon SES: email-smtp.region.amazonaws.com

SMTP_HOST=smtp.resend.com
SMTP_PORT=587
SMTP_USER=resend
SMTP_PASSWORD=your-smtp-password-change-this-in-production
SMTP_SECURE=false
SMTP_FROM_EMAIL=notification@supercheck.io

# =============================================================================
# PLAYWRIGHT CONFIGURATION
# =============================================================================

# Playwright Artifact Configuration
# Control which artifacts are collected and retained during test execution.
# Available options (for trace & video, and for screenshot in newer versions):
#   'on'                 - Always collect (for every test run)
#   'off'                - Never collect
#   'only-on-failure'    - Collect only when the test fails (original or retry)
#   'retain-on-failure'  - Collect always, but delete if test passes
#   'on-first-retry'     - Collect only when retrying a failed test (for trace & video)
#   [trace-only] 'retain-on-first-failure' — valid for trace as of certain versions :contentReference[oaicite:0]{index=0}

PLAYWRIGHT_HEADLESS=true             # Run browsers in headless mode for non-interactive test runs
PLAYWRIGHT_WORKERS=1                 # Single worker for 2GB container memory
PLAYWRIGHT_RETRIES=1                 # Retry each failing test once before final failure

PLAYWRIGHT_TRACE=retain-on-failure      # Keep trace only if the test fails
PLAYWRIGHT_SCREENSHOT=only-on-failure   # Take screenshots only on failures
PLAYWRIGHT_VIDEO=retain-on-failure      # Record video and remove if the test passes

# For maximum debugging you could use 'only-on-failure' for all,
# but that may consume more storage in CI if many tests fail.


# =============================================================================
# AI FIX FEATURE CONFIGURATION (OPTIONAL)
# =============================================================================

# AI fix feature is now always enabled

# -----------------------------------------------------------------------------
# COMMON AI CONFIGURATION
# -----------------------------------------------------------------------------

# AI Provider Selection
# Supported providers: openai (default), azure, anthropic, gemini, google-vertex, bedrock, openrouter
AI_PROVIDER=openai

# AI Model Configuration (provider-specific model IDs)
# OpenAI: gpt-4o-mini (default), gpt-4o
# Azure: Use deployment name (e.g., gpt-4o-mini)
# Anthropic: claude-3-5-haiku-20241022 (default), claude-3-5-sonnet-latest
# Gemini: gemini-2.5-flash (default), gemini-1.5-pro
# Vertex AI: gemini-2.5-flash (default), gemini-1.5-pro
# Bedrock: anthropic.claude-3-5-haiku-20241022-v1:0 (default), amazon.nova-lite-v1:0
# OpenRouter: anthropic/claude-3.5-haiku (default), openai/gpt-4o-mini, google/gemini-2.5-flash
AI_MODEL=gpt-4o-mini

# AI Service Configuration (Advanced)
AI_TIMEOUT_MS=90000          # Request timeout in milliseconds (10000-120000)
AI_MAX_RETRIES=2             # Number of retry attempts (1-5)
AI_TEMPERATURE=0.1           # Response randomness (0.0-2.0, lower = more deterministic)

# -----------------------------------------------------------------------------
# PROVIDER A: OpenAI (Default)
# Get API key from: https://platform.openai.com/api-keys
# -----------------------------------------------------------------------------

OPENAI_API_KEY=your-openai-api-key-here

# -----------------------------------------------------------------------------
# PROVIDER B: Azure OpenAI
# Setup: https://portal.azure.com → Create Azure OpenAI resource
# Get keys from: Azure Portal → Your Resource → Keys and Endpoint
# -----------------------------------------------------------------------------

# AZURE_RESOURCE_NAME=your-resource-name
# AZURE_API_KEY=your-azure-api-key
# AZURE_OPENAI_DEPLOYMENT=your-deployment-name
# AZURE_API_VERSION=2024-06-01

# For production: Use Managed Identity instead of API key
# AZURE_USE_MANAGED_IDENTITY=true

# -----------------------------------------------------------------------------
# PROVIDER C: Anthropic Claude
# Get API key from: https://console.anthropic.com/settings/keys
# -----------------------------------------------------------------------------

# ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key

# -----------------------------------------------------------------------------
# PROVIDER D: Google Gemini (AI Studio - simple API key, recommended)
# Get API key from: https://aistudio.google.com/apikey
# -----------------------------------------------------------------------------

# GOOGLE_GENERATIVE_AI_API_KEY=your-google-ai-api-key

# -----------------------------------------------------------------------------
# PROVIDER E: Google Vertex AI (GCP enterprise - requires GCP project)
# Setup: https://console.cloud.google.com/vertex-ai
# Requires: GCP project + ADC authentication
# -----------------------------------------------------------------------------

# GOOGLE_VERTEX_PROJECT=your-gcp-project-id
# GOOGLE_VERTEX_LOCATION=us-central1

# -----------------------------------------------------------------------------
# PROVIDER F: AWS Bedrock
# Setup: https://console.aws.amazon.com/bedrock
# IMPORTANT: Uses BEDROCK_* prefix to avoid conflicts with S3/R2 credentials
# On AWS infrastructure: leave credentials empty to use IAM role
# -----------------------------------------------------------------------------

# BEDROCK_AWS_REGION=us-east-1
# BEDROCK_AWS_ACCESS_KEY_ID=your-bedrock-access-key-id
# BEDROCK_AWS_SECRET_ACCESS_KEY=your-bedrock-secret-access-key
# BEDROCK_AWS_SESSION_TOKEN=optional-session-token-for-temp-creds

# -----------------------------------------------------------------------------
# PROVIDER G: OpenRouter (unified gateway to 400+ models)
# Get your API key from: https://openrouter.ai/keys
# Model IDs use provider/model format, e.g. anthropic/claude-3.5-haiku
# Features: Automatic failover, cost optimization, access to many providers
# -----------------------------------------------------------------------------

# OPENROUTER_API_KEY=sk-or-your-openrouter-api-key

# =============================================================================
# SELF-HOSTED MODE
# =============================================================================

# Self-Hosted Mode (set to 'true' for unlimited features)
# This variable controls both server and client behavior via /api/config/app
SELF_HOSTED=true
