---
title: Multi-Location Workers
description: Deploy workers in multiple geographic regions for true global coverage
icon: MapPin
---

Enable true multi-location monitoring and performance testing by deploying workers in different geographic regions.

## How It Works

```mermaid
flowchart TB
    Users[Users / CI/CD] --> T[Traefik Proxy<br/>SSL / Load Balancer]
    T --> App[Next.js App<br/>UI + API]
    
    App --> DB[(PostgreSQL<br/>Primary DB)]
    App --> Redis[(Redis + BullMQ<br/>Queue + Cache)]
    App --> S3[(MinIO<br/>Artifacts)]
    
    Redis --> W_EU[Worker EU<br/>WORKER_LOCATION=eu-central]
    
    subgraph US["US VPS"]
        W_US[Worker US<br/>WORKER_LOCATION=us-east]
    end
    
    subgraph APAC["Asia Pacific VPS"]
        W_APAC[Worker APAC<br/>WORKER_LOCATION=asia-pacific]
    end
    
    Redis -.->|Internet| W_US
    Redis -.->|Internet| W_APAC
    
    W_EU --> DB
    W_EU --> S3
    
    W_US -.->|Internet| DB
    W_US -.->|Internet| S3
    
    W_APAC -.->|Internet| DB
    W_APAC -.->|Internet| S3

    style Users fill:#6366f1,stroke:#4338ca,color:#fff
    style T fill:#0ea5e9,stroke:#0369a1,color:#fff
    style App fill:#3b82f6,stroke:#1e40af,color:#fff
    style DB fill:#f59e0b,stroke:#b45309,color:#fff
    style Redis fill:#ef4444,stroke:#b91c1c,color:#fff
    style S3 fill:#8b5cf6,stroke:#6d28d9,color:#fff
    style W_EU fill:#10b981,stroke:#047857,color:#fff
    style W_US fill:#10b981,stroke:#047857,color:#fff
    style W_APAC fill:#10b981,stroke:#047857,color:#fff
    
    style US fill:none,stroke:#64748b,stroke-width:2px,stroke-dasharray: 5 5
    style APAC fill:none,stroke:#64748b,stroke-width:2px,stroke-dasharray: 5 5
```

<Callout type="info">
**Key Insight**: Each worker only processes jobs for its designated region. A US worker only handles `us-east` jobs, an EU worker only handles `eu-central` jobs.
</Callout>

---

## Architecture Overview

| `WORKER_LOCATION` | Queues Processed | Use Case |
|-------------------|-----------------|----------|
| `local` | **All queues** (regional + global) | Local development, single-server |
| `us-east` | `playwright-global`, `k6-us-east`, `k6-global`, `monitor-us-east` | US East regional worker |
| `eu-central` | `playwright-global`, `k6-eu-central`, `k6-global`, `monitor-eu-central` | EU Central regional worker |
| `asia-pacific` | `playwright-global`, `k6-asia-pacific`, `k6-global`, `monitor-asia-pacific` | Asia Pacific regional worker |

---

## Setup Options

### <span style={{color: '#0ea5e9'}}>Option A: Single Location (Default)</span>

For most self-hosted deployments, a single location is sufficient. The main docker-compose uses `WORKER_LOCATION=local` which processes all regional queues from one server.

**No changes needed** - just deploy using the standard guide.

---

### <span style={{color: '#10b981'}}>Option B: Multi-Location (3 Regions)</span>

For true geographic distribution, deploy workers in each region.

<Steps>
  <Step>
    ### Configure Main Server Location

    Update your main server's `.env` to set a specific region:

    ```bash
    # Set to your main server's actual location
    WORKER_LOCATION=eu-central
    ```

    Restart:
    ```bash
    docker compose down && docker compose up -d
    ```
  </Step>

  <Step>
    ### Expose Services

    Update your Docker Compose to expose database services for remote workers:

    <Tabs items={['Production (Secure)', 'Testing (Insecure)']}>
      <Tab value="Production (Secure)">
        If you are using `docker-compose-secure.yml` (recommended), you need to expose the ports in that file.

        <Callout type="warning">
        **Security Notice**: See the [Security Notice](#security-notice) section below before exposing these ports.
        </Callout>

        Edit `docker-compose-secure.yml`:

        ```yaml
        services:
          postgres:
            ports:
              - "5432:5432"
          
          redis:
            ports:
              - "6379:6379"
          
          minio:
            ports:
              - "9000:9000"
        ```
      </Tab>
      <Tab value="Testing (Insecure)">
        For local testing or internal networks `docker-compose.yml`:

        ```yaml
        services:
          postgres:
            ports:
              - "5432:5432"
          
          redis:
            ports:
              - "6379:6379"
          
          minio:
            ports:
              - "9000:9000"
        ```
      </Tab>
    </Tabs>
  </Step>

  <Step>
    ### Deploy Remote Workers

    On each remote VPS:

    **1. Install Docker:**
    
    <Callout type="info">
    Skip this step if Docker is already installed on the remote VPS.
    </Callout>
    
    <Tabs items={['Linux VPS', 'macOS', 'Windows']}>
      <Tab value="Linux VPS">
        ```bash
        curl -fsSL https://get.docker.com | sh
        sudo usermod -aG docker $USER
        newgrp docker
        ```
      </Tab>
      <Tab value="macOS">
        Download [Docker Desktop](https://www.docker.com/products/docker-desktop/) for Mac.
      </Tab>
      <Tab value="Windows">
        Download [Docker Desktop](https://www.docker.com/products/docker-desktop/) for Windows.
      </Tab>
    </Tabs>

    **2. Download Worker Compose:**
    ```bash
    mkdir -p ~/supercheck-worker && cd ~/supercheck-worker
    curl -o docker-compose.yml https://raw.githubusercontent.com/supercheck-io/supercheck/main/deploy/docker/docker-compose-worker.yml
    ```

    **3. Create `.env`:**
    
    Create a `.env` file with the following configuration. Replace the placeholder values with your actual credentials from the main server:
    
    ```bash
    # ─────────────────────────────────────────────────────────────────
    # Remote Worker Configuration
    # ─────────────────────────────────────────────────────────────────
    
    # Database connection (get password from main server's .env file)
    DATABASE_URL=postgresql://postgres:YOUR_DB_PASSWORD@MAIN_SERVER_IP:5432/supercheck
    
    # Redis connection (get password from main server's .env file)
    REDIS_URL=redis://:YOUR_REDIS_PASSWORD@MAIN_SERVER_IP:6379
    
    # S3/MinIO connection (use main server's MinIO credentials)
    S3_ENDPOINT=http://MAIN_SERVER_IP:9000
    AWS_ACCESS_KEY_ID=YOUR_MINIO_ACCESS_KEY
    AWS_SECRET_ACCESS_KEY=YOUR_MINIO_SECRET_KEY
    
    # ─────────────────────────────────────────────────────────────────
    # Worker Location (choose one: us-east, eu-central, asia-pacific)
    # ─────────────────────────────────────────────────────────────────
    WORKER_LOCATION=us-east
    ```
    
    <Callout type="tip">
    Find your main server credentials in the `.env` file at `supercheck/deploy/docker/.env`.
    </Callout>

    **4. Start Worker:**
    ```bash
    docker compose up -d
    docker compose logs -f  # Verify connection
    ```
  </Step>
</Steps>

---

## Complete 3-Region Example

| Server | Region | `WORKER_LOCATION` | Queues Processed |
|--------|--------|-------------------|------------------|
| Main Server | Europe | `eu-central` | EU Central only |
| Remote VPS 1 | US | `us-east` | US East only |
| Remote VPS 2 | Asia | `asia-pacific` | Asia Pacific only |

### Main Server `.env`:
```bash
WORKER_LOCATION=eu-central
```

### US VPS `.env`:
```bash
# Worker location
WORKER_LOCATION=us-east

# Connection to main server (replace with your values)
DATABASE_URL=postgresql://postgres:YOUR_DB_PASSWORD@YOUR_MAIN_SERVER_IP:5432/supercheck
REDIS_URL=redis://:YOUR_REDIS_PASSWORD@YOUR_MAIN_SERVER_IP:6379
S3_ENDPOINT=http://YOUR_MAIN_SERVER_IP:9000
AWS_ACCESS_KEY_ID=YOUR_MINIO_ACCESS_KEY
AWS_SECRET_ACCESS_KEY=YOUR_MINIO_SECRET_KEY
```

### APAC VPS `.env`:
```bash
# Worker location
WORKER_LOCATION=asia-pacific

# Connection to main server (replace with your values)
DATABASE_URL=postgresql://postgres:YOUR_DB_PASSWORD@YOUR_MAIN_SERVER_IP:5432/supercheck
REDIS_URL=redis://:YOUR_REDIS_PASSWORD@YOUR_MAIN_SERVER_IP:6379
S3_ENDPOINT=http://YOUR_MAIN_SERVER_IP:9000
AWS_ACCESS_KEY_ID=YOUR_MINIO_ACCESS_KEY
AWS_SECRET_ACCESS_KEY=YOUR_MINIO_SECRET_KEY
```

---

## Scaling Workers

```bash
# Scale to 2 workers per location
WORKER_REPLICAS=2 docker compose up -d
```

---

## Security Notice

<Callout type="error">
**Important**: Multi-location deployments require exposing database ports (PostgreSQL, Redis, MinIO) over the network. You are responsible for securing these connections using appropriate measures such as:
- **VPN** (WireGuard, Tailscale)
- **Firewall rules** (UFW, iptables, Cloud Security Groups)
- **Encrypted tunnels**

Detailed network security configuration is beyond the scope of this documentation. Please consult your infrastructure provider's security best practices.
</Callout>

---

## Troubleshooting

**Worker can't connect to database:**
```bash
docker run --rm -it postgres:18 psql "$DATABASE_URL" -c "SELECT 1"
```

**Worker can't connect to Redis:**
```bash
docker run --rm -it redis:8 redis-cli -u "$REDIS_URL" ping
```

**Verify worker location:**
```bash
docker compose logs worker | grep "WORKER_LOCATION"
```
